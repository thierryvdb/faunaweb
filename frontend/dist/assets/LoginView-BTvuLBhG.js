import{d as q,r as s,c as r,w as V,a as l,b as U,e as b,f as y,v as S,t as v,g as x,F,h as B,A as p,o as i,_ as D}from"./index-BgSi19kN.js";const E={class:"page"},M=["disabled"],T={key:0,class:"erro"},P=["value"],I=["disabled"],j={key:0,class:"erro"},z=["disabled"],G={key:0,class:"erro"},H=q({__name:"LoginView",setup(J){const h=s(""),g=s(""),d=s(""),w=s(""),o=s(!1),n=s(null),k=s([]),m=s(""),f=s("login"),c=s(null);async function C(){var t,e,a;o.value=!0,n.value=null;try{const u=await p.login(h.value,g.value);if(c.value=u,(t=u==null?void 0:u.usuario)!=null&&t.must_reset_password){f.value="troca";return}_(u)}catch(u){n.value=((a=(e=u==null?void 0:u.response)==null?void 0:e.data)==null?void 0:a.mensagem)||"Falha no login"}finally{o.value=!1}}function _(t){var a;n.value=null;const e=(t==null?void 0:t.aeroportos_permitidos)??[];e.length>1?(k.value=e,m.value=((a=e[0])==null?void 0:a.id)??"",f.value="escolha"):window.location.href="/"}async function N(){var t,e;if(m.value){o.value=!0,n.value=null;try{await p.switchAirport(Number(m.value)),window.location.href="/"}catch(a){n.value=((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.mensagem)||"Falha ao definir aeroporto"}finally{o.value=!1}}}async function L(){var t,e;if(n.value=null,!d.value||d.value.length<6){n.value="A nova senha deve ter ao menos 6 caracteres.";return}if(d.value!==w.value){n.value="As senhas não conferem.";return}o.value=!0;try{await p.changePassword({current_password:g.value,new_password:d.value});const a=p.getUser();a&&p.setUser({...a,must_reset_password:!1}),d.value="",w.value="",c.value?(c.value.usuario.must_reset_password=!1,_(c.value)):f.value="login"}catch(a){n.value=((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.mensagem)||"Não foi possível alterar a senha"}finally{o.value=!1}}function A(){f.value="login",n.value=null,o.value=!1,k.value=[],m.value="",c.value=null,p.clearToken(),p.clearUser()}return(t,e)=>(i(),r("div",E,[f.value==="login"?(i(),r("form",{key:0,class:"card",onSubmit:V(C,["prevent"])},[e[7]||(e[7]=l("h3",null,"Acessar",-1)),l("label",null,[e[5]||(e[5]=b(" Usuário ",-1)),y(l("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),required:""},null,512),[[S,h.value]])]),l("label",null,[e[6]||(e[6]=b(" Senha ",-1)),y(l("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a),type:"password",required:""},null,512),[[S,g.value]])]),l("button",{class:"btn btn-primary",type:"submit",disabled:o.value},v(o.value?"Entrando...":"Entrar"),9,M),n.value?(i(),r("p",T,v(n.value),1)):U("",!0)],32)):f.value==="escolha"?(i(),r("form",{key:1,class:"card",onSubmit:V(N,["prevent"])},[e[10]||(e[10]=l("h3",null,"Selecionar aeroporto",-1)),l("label",null,[e[9]||(e[9]=b(" Aeroporto ",-1)),y(l("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),required:""},[e[8]||(e[8]=l("option",{value:""},"Selecione",-1)),(i(!0),r(F,null,B(k.value,a=>(i(),r("option",{key:a.id,value:a.id},v(a.icao_code)+" - "+v(a.name),9,P))),128))],512),[[x,m.value,void 0,{number:!0}]])]),l("button",{class:"btn btn-primary",type:"submit",disabled:o.value},v(o.value?"Confirmando...":"Confirmar"),9,I),l("button",{class:"btn btn-secondary",type:"button",onClick:A},"Voltar"),n.value?(i(),r("p",j,v(n.value),1)):U("",!0)],32)):(i(),r("form",{key:2,class:"card",onSubmit:V(L,["prevent"])},[e[13]||(e[13]=l("h3",null,"Definir nova senha",-1)),e[14]||(e[14]=l("p",{class:"info"},"Por segurança, defina uma nova senha antes de continuar.",-1)),l("label",null,[e[11]||(e[11]=b(" Nova senha ",-1)),y(l("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),type:"password",required:"",minlength:"6"},null,512),[[S,d.value]])]),l("label",null,[e[12]||(e[12]=b(" Confirmar senha ",-1)),y(l("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>w.value=a),type:"password",required:"",minlength:"6"},null,512),[[S,w.value]])]),l("button",{class:"btn btn-primary",type:"submit",disabled:o.value},v(o.value?"Salvando...":"Salvar nova senha"),9,z),l("button",{class:"btn btn-secondary",type:"button",onClick:A},"Cancelar"),n.value?(i(),r("p",G,v(n.value),1)):U("",!0)],32))]))}}),O=D(H,[["__scopeId","data-v-a5740608"]]);export{O as default};
